<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>SkyCast PRO ‚Ä¢ Genzie Edition</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root { 
            --bg: #0f172a; 
            --pink: #ff007a; 
            --blue: #38bdf8; 
            --glass: rgba(255, 255, 255, 0.08); 
            --text: #ffffff; 
        }
        
        body { 
            margin: 0; 
            font-family: 'Lexend', -apple-system, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
            overflow-x: hidden;
        }

        header { 
            padding: 20px; 
            font-size: 1.8rem; 
            font-weight: 900; 
            background: linear-gradient(to right, var(--pink), var(--blue)); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            text-transform: uppercase; 
        }

        main { width: 100%; max-width: 450px; padding: 10px 15px 40px 15px; box-sizing: border-box; }

        .card { 
            background: var(--glass); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px); 
            border: 1px solid rgba(255,255,255,0.1); 
            border-radius: 30px; 
            padding: 20px; 
            margin-bottom: 20px; 
        }

        .btn-main { 
            background: var(--pink); 
            border: none; 
            color: white; 
            padding: 14px; 
            border-radius: 18px; 
            font-weight: 800; 
            width: 100%; 
            text-transform: uppercase; 
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 0, 122, 0.3);
        }

        /* Map Controls */
        #map { height: 350px; width: 100%; border-radius: 22px; z-index: 1; margin-bottom: 10px; }
        
        .layer-selector { 
            display: flex; 
            gap: 8px; 
            overflow-x: auto; 
            padding-bottom: 15px; 
            scrollbar-width: none; 
        }
        
        .layer-btn { 
            background: rgba(255,255,255,0.1); 
            border: 1px solid rgba(255,255,255,0.2); 
            color: white; 
            padding: 10px 16px; 
            border-radius: 14px; 
            font-size: 0.75rem; 
            white-space: nowrap; 
            cursor: pointer;
            transition: 0.3s;
        }

        .layer-btn.active { background: var(--pink); border-color: var(--pink); transform: scale(1.05); }

        .slider-container { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 20px; text-align: center; }
        
        input[type=range] { 
            width: 100%; 
            accent-color: var(--pink); 
            margin: 10px 0; 
            cursor: pointer;
        }

        #radar-time { font-size: 0.8rem; font-weight: bold; color: var(--blue); }

        .temp-big { font-size: 3.5rem; font-weight: 800; margin: 0; }
        canvas { width: 100% !important; height: 160px !important; }

        /* Skala mapy */
        .leaflet-control-scale-line { 
            background: rgba(15, 23, 42, 0.7) !important; 
            color: white !important; 
            border: 1px solid var(--pink) !important; 
            text-shadow: none !important;
            font-size: 9px !important;
        }
    </style>
</head>
<body>

<header>SkyCast x Genzie</header>

<main>
    <button class="btn-main" onclick="locateMe()">üìç NAMIERZ MNIE (VIBE CHECK)</button>

    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div id="city" style="color: var(--blue); font-weight: 800; font-size: 0.8rem; text-transform: uppercase;">Wybierz lokacjƒô</div>
                <h1 class="temp-big" id="main-temp">--¬∞</h1>
            </div>
            <div id="main-icon"></div>
        </div>
        <div id="advice" style="margin-top:15px; font-size: 0.9rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;">
            No cap, czekam na dane... ‚è≥
        </div>
    </div>

    <div class="card">
        <h3 style="margin:0 0 10px 0; font-size: 0.8rem; color: var(--pink); text-transform: uppercase;">Prognoza temp. (24h)</h3>
        <canvas id="tempChart"></canvas>
    </div>

    <div class="card" style="padding: 12px;">
        <div class="layer-selector">
            <button class="layer-btn active" onclick="setLayer('radar', this)">üåßÔ∏è Opady</button>
            <button class="layer-btn" onclick="setLayer('temp_new', this)">üå°Ô∏è Temp</button>
            <button class="layer-btn" onclick="setLayer('wind_new', this)">üí® Wiatr</button>
            <button class="layer-btn" onclick="setLayer('pressure_new', this)">‚è≤Ô∏è Ci≈õnienie</button>
        </div>
        
        <div id="map"></div>
        
        <div class="slider-container" id="radar-ui">
            <div id="radar-time">≈Åadowanie klatek radaru...</div>
            <input type="range" id="radar-slider" min="0" max="0" value="0" oninput="showRadarFrame(this.value)">
            <div style="font-size: 0.65rem; opacity: 0.6; margin-top: 5px;">PRZESU≈É, BY ZOBACZYƒÜ RUCH CHMUR ‚òÅÔ∏è</div>
        </div>
        
        <div id="map-msg" style="text-align: center; font-size: 0.8rem; margin-top: 10px; color: var(--blue); font-weight: bold;"></div>
    </div>
</main>

<script>
    const API_KEY = "07c3b3e89d44a0eeb75b69e69c4b2264";
    let map = L.map('map', { zoomControl: false, attributionControl: false }).setView([52.2, 19.2], 6);
    
    // Podk≈Çad mapy
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
    L.control.scale({ imperial: false, position: 'bottomright' }).addTo(map);

    let radarFrames = [];
    let radarLayers = [];
    let owmLayer = null;
    let tempChart = null;
    let currentMode = 'radar';

    const layerMsgs = {
        'radar': "Radar opad√≥w live! Sprawdzaj czy nie zaleje Ci fitu. üåßÔ∏è",
        'temp_new': "Mapa cieplna! üî• Rel, zobacz gdzie jest najwiƒôkszy ogie≈Ñ.",
        'wind_new': "Wieje jak na planie! üí® Nie daj siƒô zdmuchnƒÖƒá.",
        'pressure_new': "Ci≈õnienie pod lupƒÖ. No cap, g≈Çowa czysta! ‚è≤Ô∏è"
    };

    // FUNKCJA ZMIANY WARSTW
    function setLayer(type, btn) {
        currentMode = type;
        document.querySelectorAll('.layer-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('map-msg').innerText = layerMsgs[type];

        // Czy≈õcimy mapƒô
        if (owmLayer) map.removeLayer(owmLayer);
        radarLayers.forEach(l => map.removeLayer(l));
        
        const radarUI = document.getElementById('radar-ui');
        
        if (type === 'radar') {
            radarUI.style.display = 'block';
            loadRadar();
        } else {
            radarUI.style.display = 'none';
            owmLayer = L.tileLayer(`https://tile.openweathermap.org/map/${type}/{z}/{x}/{y}.png?appid=${API_KEY}`, {
                opacity: 0.7, zIndex: 100
            }).addTo(map);
        }
    }

    // RADAR (RAINVIEWER)
    async function loadRadar() {
        try {
            const res = await fetch("https://api.rainviewer.com/public/weather-maps.json");
            const data = await res.json();
            radarFrames = [...data.radar.past, ...data.radar.nowcast];
            
            radarLayers.forEach(l => map.removeLayer(l));
            radarLayers = [];

            radarFrames.forEach(frame => {
                const layer = L.tileLayer(`https://tilecache.rainviewer.com/v2/radar/${frame.time}/{z}/{x}/{y}/2/1_1.png`, {
                    opacity: 0, zIndex: 200
                });
                layer.addTo(map);
                radarLayers.push(layer);
            });

            const slider = document.getElementById('radar-slider');
            slider.max = radarFrames.length - 1;
            slider.value = radarFrames.length - 1;
            showRadarFrame(slider.value);
        } catch (e) { document.getElementById('radar-time').innerText = "B≈ÇƒÖd radaru Ô∏è‚ö†Ô∏è"; }
    }

    function showRadarFrame(index) {
        if (currentMode !== 'radar') return;
        radarLayers.forEach((l, i) => l.setOpacity(i == index ? 0.8 : 0));
        
        const date = new Date(radarFrames[index].time * 1000);
        const timeStr = date.getHours() + ":" + date.getMinutes().toString().padStart(2, '0');
        const isFuture = index > radarFrames.length - 4;
        document.getElementById('radar-time').innerText = `CZAS: ${timeStr} ${isFuture ? '[PROGNOZA üîÆ]' : '[HISTORIA üï∞Ô∏è]'}`;
    }

    // DANE POGODOWE
    async function fetchWeather(lat, lon) {
        try {
            const curRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=pl&appid=${API_KEY}`);
            const cur = await curRes.json();
            const forRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&lang=pl&appid=${API_KEY}`);
            const fore = await forecastData = await forRes.json();

            updateDashboard(cur, fore);
        } catch (e) { alert("B≈ÇƒÖd API. Sprawd≈∫ czy klucz jest aktywny!"); }
    }

    function updateDashboard(cur, fore) {
        document.getElementById('city').innerText = cur.name;
        document.getElementById('main-temp').innerText = Math.round(cur.main.temp) + "¬∞";
        document.getElementById('main-icon').innerHTML = `<img src="https://openweathermap.org/img/wn/${cur.weather[0].icon}@2x.png" style="width:70px">`;
        
        const t = cur.main.temp;
        let advice = t > 20 ? "Jest hot! üî• T-shirt to must-have." : t > 10 ? "Vibe chillowy, wrzuƒá bluzƒô Genzie. üß•" : "Mrozi! ü•∂ Kurtka i czapa, no cap.";
        document.getElementById('advice').innerText = advice;

        renderChart(fore);
    }

    function renderChart(fore) {
        const labels = fore.list.slice(0, 8).map(i => new Date(i.dt * 1000).getHours() + ":00");
        const temps = fore.list.slice(0, 8).map(i => i.main.temp);

        if (tempChart) tempChart.destroy();
        tempChart = new Chart(document.getElementById('tempChart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    data: temps,
                    borderColor: '#ff007a',
                    backgroundColor: 'rgba(255, 0, 122, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointBackgroundColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { ticks: { color: '#fff' }, grid: { display: false } },
                    y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            }
        });
    }

    function locateMe() {
        navigator.geolocation.getCurrentPosition(p => {
            const lat = p.coords.latitude, lon = p.coords.longitude;
            map.setView([lat, lon], 10);
            fetchWeather(lat, lon);
        });
    }

    // Inicjalizacja
    setLayer('radar', document.querySelector('.layer-btn'));
    fetchWeather(52.23, 21.01); // Start na Warszawƒô
</script>

</body>
</html>
